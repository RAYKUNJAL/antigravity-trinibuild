// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ============================================
// USER & AUTHENTICATION
// ============================================

model User {
  id                    String    @id @default(cuid())
  email                 String    @unique
  phone                 String?   @unique
  firstName             String
  lastName              String
  password              String
  role                  UserRole  @default(CUSTOMER)
  
  // Profile
  avatar                String?
  bio                   String?
  dateOfBirth           DateTime?
  gender                String?
  
  // Verification
  emailVerified         DateTime?
  phoneVerified         DateTime?
  isVerified            Boolean   @default(false)
  twoFactorEnabled      Boolean   @default(false)
  twoFactorSecret       String?
  
  // Status
  status                UserStatus @default(ACTIVE)
  lastLogin             DateTime?
  lastLoginIp           String?
  
  // Preferences
  preferredLanguage     String    @default("en")
  timezone              String    @default("America/Port_of_Spain")
  notificationEmail     Boolean   @default(true)
  notificationSMS       Boolean   @default(true)
  notificationPush      Boolean   @default(true)
  
  // Relationships
  addresses             Address[]
  cart                  Cart?
  orders                Order[]
  reviews               Review[]
  messages              Message[]
  notifications         Notification[]
  vendor                Vendor?
  triniBooksProposals   TriniWorksProposal[]
  triniBookingsAsClient TriniWorksBooking[] @relation("client")
  triniBookingsAsPro    TriniWorksBooking[] @relation("professional")
  triniReviews          TriniWorksReview[]
  paymentMethods        PaymentMethod[]
  
  // Timestamps
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt
  
  @@index([email])
  @@index([status])
  @@index([role])
}

enum UserRole {
  CUSTOMER
  VENDOR
  ADMIN
  SUPER_ADMIN
  DRIVER
  PROFESSIONAL      // For TriniWorks
}

enum UserStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
  LOCKED
  PENDING_VERIFICATION
  DELETED
}

model Address {
  id                String    @id @default(cuid())
  userId            String
  user              User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  label             String?   // Home, Work, etc.
  street            String
  city              String
  state             String?
  zipCode           String
  country           String   @default("TT")
  
  lat               Float?
  lng               Float?
  
  isDefault         Boolean   @default(false)
  
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  
  @@index([userId])
}

// ============================================
// MARKETPLACE - VENDOR/SELLER
// ============================================

model Vendor {
  id                    String    @id @default(cuid())
  userId                String    @unique
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // Store Info
  businessName          String
  description           String?
  category              String
  logo                  String?
  bannerImage           String?
  website               String?
  
  // Verification
  verified              Boolean   @default(false)
  verificationStatus    VerificationStatus @default(PENDING)
  verifiedAt            DateTime?
  
  // Documents
  businessRegistration  String?
  taxId                 String?
  bankAccountName       String?
  bankAccountNumber     String?
  bankName              String?
  bankRoutingNumber     String?
  
  // Stats
  rating                Float     @default(0)
  totalReviews          Int       @default(0)
  totalSales            Int       @default(0)
  totalRevenue          Float     @default(0)
  responseTime          Int?      // minutes
  
  // Commission
  commission            Float     @default(2.5)
  
  // Status
  status                String    @default("ACTIVE")
  suspendedUntil        DateTime?
  suspensionReason      String?
  
  // Relationships
  products              Product[]
  orders                OrderItem[]
  vendorReviews         VendorReview[]
  payoutAccounts        PayoutAccount[]
  
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt
  
  @@index([userId])
  @@index([verified])
  @@index([status])
}

enum VerificationStatus {
  PENDING
  APPROVED
  REJECTED
  SUSPENDED
}

model PayoutAccount {
  id                String    @id @default(cuid())
  vendorId          String
  vendor            Vendor    @relation(fields: [vendorId], references: [id], onDelete: Cascade)
  
  accountHolderName String
  accountNumber     String
  bankName          String
  routingNumber     String?
  currency          String    @default("TTD")
  
  isDefault         Boolean   @default(false)
  verified          Boolean   @default(false)
  
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  
  @@index([vendorId])
}

// ============================================
// MARKETPLACE - PRODUCTS
// ============================================

model Product {
  id                    String    @id @default(cuid())
  vendorId              String
  vendor                Vendor    @relation(fields: [vendorId], references: [id], onDelete: Cascade)
  
  // Basic Info
  title                 String
  slug                  String    @unique
  description           String
  category              String
  subcategory           String?
  brand                 String?
  model                 String?
  
  // Pricing
  price                 Float
  currency              String    @default("TTD")
  originalPrice         Float?
  discount              Float?    // percentage
  costPrice             Float?
  
  // Inventory
  quantity              Int
  quantitySold          Int       @default(0)
  reorderLevel          Int       @default(10)
  sku                   String?   @unique
  barcode               String?
  
  // Media
  images                String[]  // JSON array of URLs
  thumbnail             String?
  video                 String?
  
  // Specifications
  specifications        Json?     // JSON object of key-value pairs
  attributes            Json?     // Product attributes (size, color, etc.)
  
  // Ratings & Reviews
  rating                Float     @default(0)
  totalReviews          Int       @default(0)
  reviews               Review[]
  
  // Shipping
  weight                Float?    // kg
  dimensions            Json?     // {length, width, height} in cm
  shippingCost          Float     @default(0)
  freeShipping          Boolean   @default(false)
  estimatedDelivery     Int       @default(5) // days
  
  // Tags & SEO
  tags                  String[]  // JSON array
  keywords              String?
  metaTitle             String?
  metaDescription       String?
  
  // Policies
  returnable            Boolean   @default(true)
  returnWindow          Int?      // days
  warranty              String?
  
  // Status
  isActive              Boolean   @default(true)
  isFeatured            Boolean   @default(false)
  isFlashSale           Boolean   @default(false)
  flashSaleEndDate      DateTime?
  
  // Analytics
  views                 Int       @default(0)
  wishlistCount         Int       @default(0)
  cartCount             Int       @default(0)
  
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt
  
  // Relationships
  cartItems             CartItem[]
  orderItems            OrderItem[]
  
  @@index([vendorId])
  @@index([category])
  @@index([isActive])
  @@index([slug])
}

model ProductImage {
  id                String    @id @default(cuid())
  productId         String
  url               String
  altText           String?
  sortOrder         Int       @default(0)
  
  createdAt         DateTime  @default(now())
}

// ============================================
// MARKETPLACE - CART & ORDERS
// ============================================

model Cart {
  id                String    @id @default(cuid())
  userId            String    @unique
  user              User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  items             CartItem[]
  
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  
  @@index([userId])
}

model CartItem {
  id                String    @id @default(cuid())
  cartId            String
  cart              Cart      @relation(fields: [cartId], references: [id], onDelete: Cascade)
  
  productId         String
  product           Product   @relation(fields: [productId], references: [id], onDelete: Cascade)
  
  quantity          Int       @default(1)
  addedAt           DateTime  @default(now())
  
  @@unique([cartId, productId])
  @@index([cartId])
  @@index([productId])
}

model Order {
  id                    String    @id @default(cuid())
  orderNumber           String    @unique @default(cuid())
  userId                String
  user                  User      @relation(fields: [userId], references: [id])
  
  // Order Details
  items                 OrderItem[]
  status                OrderStatus @default(PENDING)
  
  // Totals
  subtotal              Float
  shippingCost          Float     @default(0)
  taxAmount             Float     @default(0)
  discount              Float     @default(0)
  total                 Float
  currency              String    @default("TTD")
  
  // Shipping
  shippingAddressId     String?
  shippingMethod        String?
  trackingNumber        String?
  estimatedDelivery     DateTime?
  
  // Payment
  paymentId             String?
  payment               Payment?  @relation(fields: [paymentId], references: [id])
  paymentMethod         String?   // "credit_card", "debit_card", "bank_transfer", "ttd_gateway"
  paymentStatus         PaymentStatus @default(PENDING)
  
  // Notes
  notes                 String?
  cancelReason          String?
  
  // Timestamps
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt
  paidAt                DateTime?
  shippedAt             DateTime?
  deliveredAt           DateTime?
  canceledAt            DateTime?
  
  @@index([userId])
  @@index([status])
  @@index([paymentStatus])
  @@index([orderNumber])
}

model OrderItem {
  id                String    @id @default(cuid())
  orderId           String
  order             Order     @relation(fields: [orderId], references: [id], onDelete: Cascade)
  
  vendorId          String
  vendor            Vendor    @relation(fields: [vendorId], references: [id])
  
  productId         String
  product           Product   @relation(fields: [productId], references: [id])
  
  quantity          Int
  price             Float     // Price at time of order
  subtotal          Float
  
  status            OrderItemStatus @default(PENDING)
  
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  
  @@index([orderId])
  @@index([vendorId])
  @@index([productId])
}

enum OrderStatus {
  PENDING
  CONFIRMED
  PROCESSING
  SHIPPED
  DELIVERED
  COMPLETED
  CANCELLED
  REFUNDED
  DISPUTED
}

enum OrderItemStatus {
  PENDING
  CONFIRMED
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED
  REFUNDED
}

// ============================================
// PAYMENTS
// ============================================

model Payment {
  id                    String    @id @default(cuid())
  transactionId         String    @unique
  orderId               String
  
  amount                Float
  currency              String    @default("TTD")
  
  method                PaymentMethod_ @default(STRIPE)
  status                PaymentStatus @default(PENDING)
  
  // Payment Details
  paymentIntentId       String?   // Stripe payment intent ID
  receiptUrl            String?
  failureMessage        String?
  
  // TTD Gateway Fields
  ttdGateway            String?   // FCIB, REPUBLIC_BANK, FLOW_MOBILE, NATIONAL_SECURE
  gatewayTransactionId  String?
  gatewayResponse       Json?
  
  // Metadata
  metadata              Json?
  
  orders                Order[]
  refunds               Refund[]
  
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt
  
  @@index([status])
  @@index([transactionId])
}

enum PaymentMethod_ {
  STRIPE
  PAYPAL
  FCIB
  REPUBLIC_BANK
  FLOW_MOBILE
  NATIONAL_SECURE
  BANK_TRANSFER
  CASH_ON_DELIVERY
}

enum PaymentStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
  REFUNDED
  CANCELLED
}

model Refund {
  id                String    @id @default(cuid())
  paymentId         String
  payment           Payment   @relation(fields: [paymentId], references: [id])
  
  amount            Float
  reason            String
  status            RefundStatus @default(PENDING)
  
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  
  @@index([paymentId])
}

enum RefundStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
  CANCELLED
}

model PaymentMethod {
  id                String    @id @default(cuid())
  userId            String
  user              User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  type              String    // "card", "bank", "wallet"
  provider          String    // "stripe", "paypal", etc.
  
  // Card Details (encrypted)
  cardLast4         String?
  cardBrand         String?   // visa, mastercard, etc.
  cardExpiry        String?
  
  // Bank Details (encrypted)
  accountLast4      String?
  bankName          String?
  
  isDefault         Boolean   @default(false)
  
  // Stripe
  stripePaymentMethodId String?
  
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  
  @@index([userId])
}

// ============================================
// REVIEWS & RATINGS
// ============================================

model Review {
  id                String    @id @default(cuid())
  productId         String
  product           Product   @relation(fields: [productId], references: [id], onDelete: Cascade)
  
  userId            String
  user              User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  rating            Int       // 1-5
  title             String
  comment           String
  
  images            String[]  // JSON array of image URLs
  
  verified          Boolean   @default(false) // Purchased this product
  helpful           Int       @default(0)
  unhelpful         Int       @default(0)
  
  vendorResponse    String?
  vendorResponseAt  DateTime?
  
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  
  @@unique([productId, userId])
  @@index([productId])
  @@index([userId])
  @@index([rating])
}

model VendorReview {
  id                String    @id @default(cuid())
  vendorId          String
  vendor            Vendor    @relation(fields: [vendorId], references: [id], onDelete: Cascade)
  
  userId            String
  rating            Int       // 1-5
  comment           String?
  
  createdAt         DateTime  @default(now())
  
  @@index([vendorId])
}

// ============================================
// MESSAGING & NOTIFICATIONS
// ============================================

model Conversation {
  id                String    @id @default(cuid())
  
  participant1Id    String
  participant1      User      @relation("conversations1", fields: [participant1Id], references: [id], onDelete: Cascade)
  
  participant2Id    String
  participant2      User      @relation("conversations2", fields: [participant2Id], references: [id], onDelete: Cascade)
  
  relatedOrderId    String?   // For order-related conversations
  relatedJobId      String?   // For TriniWorks job conversations
  
  lastMessage       String?
  lastMessageTime   DateTime?
  
  messages          Message[]
  
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  
  @@unique([participant1Id, participant2Id])
  @@index([participant1Id])
  @@index([participant2Id])
}

model Message {
  id                String    @id @default(cuid())
  conversationId    String
  conversation      Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  
  senderId          String
  sender            User      @relation(fields: [senderId], references: [id], onDelete: Cascade)
  
  content           String
  type              MessageType @default(TEXT)
  
  // Attachments
  attachments       String[]  // JSON array of file URLs
  
  // Status
  read              Boolean   @default(false)
  readAt            DateTime?
  
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  
  @@index([conversationId])
  @@index([senderId])
}

enum MessageType {
  TEXT
  IMAGE
  FILE
  DOCUMENT
  QUOTE
}

model Notification {
  id                String    @id @default(cuid())
  userId            String
  user              User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  type              NotificationType
  title             String
  message           String
  icon              String?
  
  // Data for linking to entities
  relatedOrderId    String?
  relatedJobId      String?
  relatedUserId     String?
  
  read              Boolean   @default(false)
  readAt            DateTime?
  
  actionUrl         String?
  actionLabel       String?
  
  createdAt         DateTime  @default(now())
  expiredAt         DateTime?
  
  @@index([userId])
  @@index([read])
  @@index([type])
}

enum NotificationType {
  ORDER_CONFIRMED
  ORDER_SHIPPED
  ORDER_DELIVERED
  PAYMENT_SUCCESSFUL
  PAYMENT_FAILED
  REVIEW_REQUESTED
  MESSAGE_RECEIVED
  PRICE_DROP
  PRODUCT_AVAILABLE
  TRINIWORKS_PROPOSAL
  TRINIWORKS_BOOKING
  TRINIWORKS_REVIEW
  ADMIN_ALERT
  SYSTEM_UPDATE
}

// ============================================
// TRINIWOR KS - SERVICE PROFESSIONALS
// ============================================

model TriniWorksProfessional {
  id                    String    @id @default(cuid())
  userId                String    @unique
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // Business Info
  businessName          String
  firstName             String
  lastName              String
  category              String    // plumbing, electrical, etc.
  subcategories         String[]  // JSON array
  
  // Verification
  licenseNumber         String    @unique
  licenseExpiry         DateTime
  insurance             Boolean   @default(false)
  bonded                Boolean   @default(false)
  backgroundChecked     Boolean   @default(false)
  insuranceVerified     Boolean   @default(false)
  verified              Boolean   @default(false)
  
  // Profile
  profileImage          String?
  bio                   String?
  yearsInBusiness       Int?
  
  // Location
  serviceArea           String[]  // JSON array of cities
  city                  String
  state                 String?
  coordinates           Json?     // {lat, lng}
  
  // Work Hours
  workHours             Json      // {monday: {open, close, closed}, ...}
  minimumJobPrice       Float     @default(500)
  currency              String    @default("TTD")
  
  // Ratings
  averageRating         Float     @default(0)
  totalReviews          Int       @default(0)
  responseTime          Int?      // minutes
  responseRate          Float?    // percentage
  
  // Stats
  jobsCompleted         Int       @default(0)
  repeatCustomers       Int       @default(0)
  totalEarnings         Float     @default(0)
  
  // Status
  accountStatus         String    @default("ACTIVE")
  available             Boolean   @default(true)
  
  // Bank
  bankAccountName       String?
  bankAccountNumber     String?
  bankName              String?
  
  // Relationships
  credentials           TriniWorksCredential[]
  portfolioImages       String[]  // JSON array
  paymentPlans          TriniWorksPaymentPlan[]
  services              TriniWorksService[]
  proposals             TriniWorksProposal[]
  bookings              TriniWorksBooking[] @relation("professional")
  reviews               TriniWorksReview[]
  
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt
  
  @@index([userId])
  @@index([verified])
  @@index([category])
}

model TriniWorksCredential {
  id                String    @id @default(cuid())
  professionalId    String
  professional      TriniWorksProfessional @relation(fields: [professionalId], references: [id], onDelete: Cascade)
  
  name              String    // Certificate name
  issuer            String    // Organization
  year              String
  documentUrl       String?
  
  createdAt         DateTime  @default(now())
}

model TriniWorksService {
  id                String    @id @default(cuid())
  professionalId    String
  professional      TriniWorksProfessional @relation(fields: [professionalId], references: [id], onDelete: Cascade)
  
  name              String
  description       String?
  price             Float
  currency          String    @default("TTD")
  
  createdAt         DateTime  @default(now())
}

model TriniWorksPaymentPlan {
  id                String    @id @default(cuid())
  professionalId    String
  professional      TriniWorksProfessional @relation(fields: [professionalId], references: [id], onDelete: Cascade)
  
  name              String
  description       String?
  type              String    // "basic", "professional", "enterprise"
  price             Float
  currency          String    @default("TTD")
  billingCycle      Int       @default(30) // days
  
  features          String[]  // JSON array
  maxListings       Int?
  maxProposalsPerMonth Int?
  featuredListings  Int?
  priority          Boolean   @default(false)
  analyticsAccess   Boolean   @default(false)
  apiAccess         Boolean   @default(false)
  dedicatedSupport  Boolean   @default(false)
  
  createdAt         DateTime  @default(now())
}

// ============================================
// TRINIWOR KS - JOBS & PROPOSALS
// ============================================

model TriniWorksJob {
  id                    String    @id @default(cuid())
  title                 String
  description           String
  category              String
  subcategory           String?
  
  clientId              String
  client                User      @relation(fields: [clientId], references: [id], onDelete: Cascade)
  clientName            String
  clientEmail           String
  clientPhone           String
  
  location              String
  city                  String
  coordinates           Json?     // {lat, lng}
  
  jobType               String    // "one_time", "ongoing", "hourly"
  urgency               String    // "asap", "flexible", "specific_date"
  
  budgetMin             Float
  budgetMax             Float
  budgetNegotiable      Boolean   @default(true)
  currency              String    @default("TTD")
  
  startDate             DateTime?
  endDate               DateTime?
  duration              Int?      // days
  flexibleDates         Boolean   @default(false)
  
  paymentMethod         String    // "upfront", "milestone", "payment_plan", "after_completion"
  
  status                JobStatus @default(OPEN)
  
  featuredUntil         DateTime?
  
  images                String[]  // JSON array
  documents             String[]  // JSON array
  
  proposalDeadline      DateTime?
  bidsReceived          Int       @default(0)
  
  assignedProfessionalId String?
  assignedProfessional  TriniWorksProfessional? @relation(fields: [assignedProfessionalId], references: [id])
  
  proposals             TriniWorksProposal[]
  bookings              TriniWorksBooking[]
  
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt
  
  @@index([clientId])
  @@index([status])
  @@index([category])
}

enum JobStatus {
  OPEN
  IN_PROGRESS
  COMPLETED
  CANCELLED
  ON_HOLD
}

model TriniWorksProposal {
  id                    String    @id @default(cuid())
  jobId                 String
  job                   TriniWorksJob @relation(fields: [jobId], references: [id], onDelete: Cascade)
  
  professionalId        String
  professional          TriniWorksProfessional @relation(fields: [professionalId], references: [id], onDelete: Cascade)
  
  userId                String
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  proposedPrice         Float
  currency              String    @default("TTD")
  duration              Int       // days
  
  coverLetter           String
  
  status                ProposalStatus @default(PENDING)
  acceptedAt            DateTime?
  
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt
  
  @@unique([jobId, professionalId])
  @@index([jobId])
  @@index([professionalId])
  @@index([status])
}

enum ProposalStatus {
  PENDING
  ACCEPTED
  REJECTED
  WITHDRAWN
  EXPIRED
}

model TriniWorksBooking {
  id                    String    @id @default(cuid())
  jobId                 String
  job                   TriniWorksJob @relation(fields: [jobId], references: [id], onDelete: Cascade)
  
  proposalId            String
  clientId              String
  client                User      @relation("client", fields: [clientId], references: [id], onDelete: Cascade)
  
  professionalId        String
  professional          TriniWorksProfessional @relation("professional", fields: [professionalId], references: [id], onDelete: Cascade)
  
  title                 String
  description           String
  
  agreedPrice           Float
  currency              String    @default("TTD")
  deposit               Float
  depositPaid           Boolean   @default(false)
  totalPaid             Float     @default(0)
  
  scheduledDate         String
  duration              Int       // hours
  
  location              String
  
  status                BookingStatus @default(CONFIRMED)
  
  messages              String[]  // JSON array of message IDs
  reviewId              String?
  
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt
  completedAt           DateTime?
  
  @@index([clientId])
  @@index([professionalId])
  @@index([status])
}

enum BookingStatus {
  CONFIRMED
  IN_PROGRESS
  COMPLETED
  CANCELLED
  DISPUTED
  PAYMENT_PENDING
}

model TriniWorksReview {
  id                    String    @id @default(cuid())
  bookingId             String
  
  professionalId        String
  professional          TriniWorksProfessional @relation(fields: [professionalId], references: [id], onDelete: Cascade)
  
  userId                String
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  rating                Int       // 1-5
  title                 String
  comment               String
  
  qualityRating         Int?      // 1-5
  punctualityRating     Int?      // 1-5
  communicationRating   Int?      // 1-5
  valueRating           Int?      // 1-5
  
  images                String[]  // JSON array
  
  professionalResponse  String?
  respondedAt           DateTime?
  
  createdAt             DateTime  @default(now())
  
  @@index([professionalId])
  @@index([userId])
}

// ============================================
// ANALYTICS
// ============================================

model PageView {
  id                String    @id @default(cuid())
  userId            String?
  path              String
  referrer          String?
  userAgent         String?
  ipAddress         String?
  
  createdAt         DateTime  @default(now())
  
  @@index([userId])
  @@index([path])
}

model UserEvent {
  id                String    @id @default(cuid())
  userId            String
  eventType         String    // "product_view", "add_to_cart", "purchase", etc.
  eventData         Json?
  
  createdAt         DateTime  @default(now())
  
  @@index([userId])
  @@index([eventType])
}

// ============================================
// ADMIN & SUPPORT
// ============================================

model Dispute {
  id                String    @id @default(cuid())
  orderId           String?
  bookingId         String?
  
  initiatedBy       String    // userId
  respondent        String    // userId
  
  reason            String
  description       String
  
  evidence          String[]  // JSON array of URLs
  
  status            DisputeStatus @default(OPEN)
  resolution        String?
  
  createdAt         DateTime  @default(now())
  resolvedAt        DateTime?
}

enum DisputeStatus {
  OPEN
  UNDER_REVIEW
  RESOLVED
  ESCALATED
  CLOSED
}

model SystemLog {
  id                String    @id @default(cuid())
  action            String
  userId            String?
  entityType        String?
  entityId          String?
  details           Json?
  
  createdAt         DateTime  @default(now())
  
  @@index([action])
  @@index([userId])
}

model PlatformSettings {
  id                String    @id @default(cuid())
  key               String    @unique
  value             Json
  
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
}
